
#include <stdio.h>
#include <string.h>

#include <stdlib.h>
#include <string.h>

/* XOR String Decryption Helper */
static char* _xor_decrypt(const unsigned char* enc, int len, unsigned char key) {
    char* dec = (char*)malloc(len + 1);
    if (!dec) return NULL;
    for (int i = 0; i < len; i++) {
        dec[i] = enc[i] ^ key;
    }
    dec[len] = '\0';
    return dec;
}

static void _secure_free(char* ptr) {
    if (ptr) {
        memset(ptr, 0, strlen(ptr));
        free(ptr);
    }
}


// Secrets that should be hidden
char* MASTER_KEY = NULL;
char* DB_CONN = NULL;
char* API_TOKEN = NULL;

// Functions that should be obfuscated
int validate_credentials(const char* username, const char* password) {
    if (strcmp(username, _xor_decrypt((const unsigned char[]){0xf2,0xf7,0xfe,0xfa,0xfd}, 5, 0x93)) == 0 && strcmp(password, MASTER_KEY) == 0) {
        return 1;
    }
    return 0;
}

int check_authorization(const char* token) {
    return strcmp(token, API_TOKEN) == 0;
}

void connect_database() {
    printf("Connecting to: %s\n", DB_CONN);
}

int main(int argc, char** argv) {
    printf("=== Secure Application ===\n");
    
    if (argc < 3) {
        printf("Usage: %s <username> <password>\n", argv[0]);
        return 1;
    }
    
    if (validate_credentials(argv[1], argv[2])) {
        printf("Access granted\n");
        connect_database();
        return 0;
    }
    
    printf("Access denied\n");
    return 1;
}


/* String decryption initialization (runs before main) */
__attribute__((constructor)) static void _init_encrypted_strings(void) {
    MASTER_KEY = _xor_decrypt((const unsigned char[]){0xf9,0xfb,0xe6,0xed,0xd6,0xe4,0xe8,0xfa,0xfd,0xec,0xfb,0xd6,0xe2,0xec,0xf0,0xd6,0xbb,0xb9,0xbb,0xbd,0xd6,0xf1,0xf0,0xf3}, 24, 0x89);
    DB_CONN = _xor_decrypt((const unsigned char[]){0xc6,0xd9,0xc5,0xc2,0xd1,0xc4,0xd3,0xc5,0x8c,0x99,0x99,0xd7,0xd2,0xdb,0xdf,0xd8,0x8c,0xe5,0xd3,0xd5,0xc3,0xc4,0xd3,0xe6,0xd7,0xc5,0xc5,0x87,0x84,0x85,0xf6,0xc6,0xc4,0xd9,0xd2,0x9b,0xd2,0xd4,0x98,0xd3,0xce,0xd7,0xdb,0xc6,0xda,0xd3,0x98,0xd5,0xd9,0xdb,0x8c,0x83,0x82,0x85,0x84,0x99,0xdb,0xd7,0xdf,0xd8,0xd2,0xd4}, 62, 0xb6);
    API_TOKEN = _xor_decrypt((const unsigned char[]){0x1c,0x3b,0x3f,0x2c,0x3b,0x2c,0x7e,0x2d,0x35,0x01,0x32,0x37,0x28,0x3b,0x01,0x3f,0x3c,0x3d,0x6f,0x6c,0x6d,0x3a,0x3b,0x38,0x6a,0x6b,0x68,0x39,0x36,0x37,0x69,0x66,0x67,0x34,0x35,0x32,0x6e,0x6f,0x6c}, 39, 0x5e);
}
